#!/usr/bin/env node
'use strict';

const fs = require('fs');
const cheerio = require('cheerio');
const extract = require('../index');
const formatYaml = require('../src/format-yaml');

const args = (() => {
    const argparse = require('argparse');
    const parser = new argparse.ArgumentParser({
        version: '0.1.0',
        addHelp: true,
        description: 'xlf-extract extracts source messages from XLIFF (.xlf) files'
    });

    parser.addArgument([ '-l', '--lang-file' ], {
        help: 'destination file to populate with source messages (YAML)',
        required: true
    });

    parser.addArgument([ '-m', '--messages-file' ], {
        help: 'messages file to process',
        required: true
    });

    return parser.parseArgs();
})();

const messageData = fs.readFileSync(args.messages_file);
const messages = cheerio.load(messageData, { xmlMode: true, decodeEntities: false });
const units = extract(messages);
const out = formatYaml(units);

fs.writeFileSync(args.lang_file, out);
console.log('Done.');
